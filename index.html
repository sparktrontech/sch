<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart School Bell Panel</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
body{
font-family:Segoe UI;
background:#f4f6f9;
margin:0;
padding-bottom:100px;
}

header{
background:#1e3d59;
color:white;
padding:15px 20px;
display:flex;
justify-content:space-between;
align-items:center;
flex-wrap:wrap;
}

.schoolName{
font-size:22px;
font-weight:bold;
cursor:pointer;
}

.clockBox{
text-align:right;
}

#clock{
font-size:22px;
font-weight:bold;
}

.status{
padding:5px 10px;
border-radius:6px;
font-size:13px;
margin-top:5px;
display:inline-block;
}

.online{ background:#27ae60; }
.offline{ background:#e74c3c; }

.container{
width:95%;
margin:auto;
margin-top:20px;
}

.card{
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 4px 12px rgba(0,0,0,0.1);
margin-bottom:20px;
}

input,select{
padding:8px;
margin:5px;
border-radius:6px;
border:1px solid #ccc;
}

button{
padding:8px 15px;
border:none;
border-radius:6px;
cursor:pointer;
margin:3px;
}

.addBtn{ background:#27ae60; color:white; }
.deleteBtn{ background:#e74c3c; color:white; }
.exportBtn{ background:#2980b9; color:white; }

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

th,td{
border:1px solid #ccc;
padding:8px;
text-align:center;
}

.hidden{ display:none; }

/* Footer */
footer{
background:#1e3d59;
color:white;
text-align:center;
padding:15px;
font-size:14px;
position:fixed;
bottom:0;
width:100%;
}
</style>
</head>

<body>

<header>
<div class="schoolName" onclick="editSchoolName()" id="schoolTitle">
Your School Name
</div>

<div class="clockBox">
<div id="clock">00:00:00</div>
<div id="date"></div>
<div id="espStatus" class="status offline">ESP Offline</div>
</div>
</header>

<div class="container">

<div class="card" id="loginBox">
<h3>Admin Login</h3>
<input type="text" id="username" placeholder="Username"><br>
<input type="password" id="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
</div>

<div class="card hidden" id="dashboard">

<h3>Add Bell Schedule</h3>

<select id="day">
<option>Monday</option>
<option>Tuesday</option>
<option>Wednesday</option>
<option>Thursday</option>
<option>Friday</option>
<option>Saturday</option>
<option>Sunday</option>
</select>

<input type="number" id="hour" min="0" max="23" placeholder="Hour (0-23)">
<input type="number" id="minute" min="0" max="59" placeholder="Minute (0-59)">
<input type="number" id="duration" placeholder="Duration (sec)">

<label>
<input type="checkbox" id="repeatNext"> Repeat Next Day
</label>

<br>
<button class="addBtn" onclick="addSchedule()">Add</button>
<button class="exportBtn" onclick="exportJSON()">Export JSON</button>

<h3>Weekly Time Table</h3>

<table id="table">
<tr>
<th>Day</th>
<th>Time</th>
<th>Duration</th>
<th>Action</th>
</tr>
</table>

</div>
</div>

<script>

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  databaseURL: "YOUR_DATABASE_URL",
  projectId: "YOUR_PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

/* CLOCK */
function updateClock(){
let now=new Date();
let h=now.getHours().toString().padStart(2,'0');
let m=now.getMinutes().toString().padStart(2,'0');
let s=now.getSeconds().toString().padStart(2,'0');
document.getElementById("clock").innerHTML=h+":"+m+":"+s;

let options={weekday:'long', year:'numeric', month:'long', day:'numeric'};
document.getElementById("date").innerHTML=now.toLocaleDateString(undefined,options);
}
setInterval(updateClock,1000);

/* ESP STATUS */
database.ref("espStatus").on("value", snapshot=>{
if(snapshot.val()==="online"){
document.getElementById("espStatus").innerHTML="ESP Online";
document.getElementById("espStatus").className="status online";
}else{
document.getElementById("espStatus").innerHTML="ESP Offline";
document.getElementById("espStatus").className="status offline";
}
});

/* LOGIN */
function login(){
let user=document.getElementById("username").value;
let pass=document.getElementById("password").value;

if(user==="admin" && pass==="1234"){
document.getElementById("loginBox").classList.add("hidden");
document.getElementById("dashboard").classList.remove("hidden");
loadFromFirebase();
}else{
alert("Wrong login");
}
}

/* SCHOOL NAME */
function editSchoolName(){
let newName=prompt("Enter School Name");
if(newName){
document.getElementById("schoolTitle").innerHTML=newName;
}
}

let schedules=[];

function addSchedule(){
let day=document.getElementById("day").value;
let hour=document.getElementById("hour").value;
let minute=document.getElementById("minute").value;
let duration=document.getElementById("duration").value;
let repeat=document.getElementById("repeatNext").checked;

if(hour==="" || minute==="" || duration===""){
alert("Fill all fields");
return;
}

hour=hour.toString().padStart(2,'0');
minute=minute.toString().padStart(2,'0');

let alreadyExists = schedules.some(item => 
item.day === day && item.time === hour+":"+minute
);

if(alreadyExists){
alert("Time already exists!");
return;
}

schedules.push({day:day,time:hour+":"+minute,duration:duration});

if(repeat){
let days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
let index=days.indexOf(day);
if(index<6){
schedules.push({day:days[index+1],time:hour+":"+minute,duration:duration});
}
}

schedules.sort((a,b)=>{
if(a.day===b.day){
return a.time.localeCompare(b.time);
}
return a.day.localeCompare(b.day);
});

saveToFirebase();
renderTable();

document.getElementById("hour").value="";
document.getElementById("minute").value="";
document.getElementById("duration").value="";
document.getElementById("repeatNext").checked=false;
}

function renderTable(){
let table=document.getElementById("table");
table.innerHTML="<tr><th>Day</th><th>Time</th><th>Duration</th><th>Action</th></tr>";

schedules.forEach((item,index)=>{
let row=table.insertRow(-1);
row.insertCell(0).innerHTML=item.day;
row.insertCell(1).innerHTML=item.time;
row.insertCell(2).innerHTML=item.duration+" sec";
row.insertCell(3).innerHTML=
"<button class='deleteBtn' onclick='deleteRow("+index+")'>Delete</button>";
});
}

function deleteRow(index){
schedules.splice(index,1);
saveToFirebase();
renderTable();
}

function saveToFirebase(){
database.ref("timetable").set(schedules);
}

function loadFromFirebase(){
database.ref("timetable").on("value",snapshot=>{
if(snapshot.exists()){
schedules=snapshot.val();
renderTable();
}
});
}

function exportJSON(){
let dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(schedules,null,2));
let dl=document.createElement("a");
dl.setAttribute("href",dataStr);
dl.setAttribute("download","school_bell_schedule.json");
dl.click();
}

</script>

<footer>
Developed by Vishwajeet Jadhav <br>
Smart IoT Bell System <br>
ðŸ“§ jadhavvishwajeet94@gmail.com
</footer>

</body>
</html>
